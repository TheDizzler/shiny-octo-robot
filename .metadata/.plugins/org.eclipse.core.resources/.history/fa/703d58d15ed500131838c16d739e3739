package vdindustries.networking;

import java.io.InputStream;
import java.util.ArrayList;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;

import vdindustries.masterflow.R;
import android.content.Intent;
import android.os.Bundle;
import android.support.v7.app.ActionBarActivity;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;


public class ConnectActivity extends ActionBarActivity {
	
	TextView						status;
	static InputStream				is;
	static ArrayList<NameValuePair>	nvp;
	
	private int						serverIP;
	
	public void onCreate(Bundle savedInstanceState) {
	
		super.onCreate(savedInstanceState);
		
		setContentView(R.layout.activity_connect);
		
		Button connect = (Button) findViewById(R.id.connBtn);
		status = (TextView) findViewById(R.id.tvStatus);
		
		connect.setOnClickListener(new View.OnClickListener() {
			
			
			
			@Override public void onClick(View v) {
			
				try {
					nvp = new ArrayList<NameValuePair>();
					//Pass user message with Index Value "UserMessage"
					nvp.add(new BasicNameValuePair("UserMessage", msgToServer));
					
					//Call httpConnection passing arrayList and InputStream 
					HttpConnect.httpConnection(nvp, is);
					Log.d("<<<-Inside insertMsgToServer->>>", "Success in saving msg into server");
					
				} catch (Exception ex) {
					Log.d("<<<-Inside insertMsgToServer->>>", "Error in saving msg into server");
				}
			}
		});
	}
	
	public void onActivityResult(int requestcode, int resultCode, Intent data) {
	
		if (resultCode == RESULT_OK) {
			status.setText("connected!....?");
		}
	}
}

class HttpConnect {
	
	/** @param nameValuePairs passing arraylist with all information added
	 * @param inputStream passing inputStream from user request */
	
	public static void httpConnection(ArrayList<NameValuePair> nvp,
										InputStream is) {
	
		try {
			HttpClient httpClient = new DefaultHttpClient();
			
			/* when you want the emulator client to contact to server
			 * running on the same host, use the alias 10.0.2.2 to
			 * refer to the host computeres loopback interface.
			 * From the emulators perspective, localhost (127.0.0.1)
			 * refers to its own loopback interface.So localhost or
			 * 127.0.0.1 will not */
			HttpPost httpPost = new HttpPost("http://qdap.ca");
			
			// Pass nameValuePairs to server
			httpPost.setEntity(new UrlEncodedFormEntity(nvp));
			
			HttpResponse response = httpClient.execute(httpPost);
			HttpEntity entity = response.getEntity();
			is = entity.getContent();
			Log.d("<<<-http_log_tag->>>","Succes in Http Connection");
			
		} catch (Exception e) {
			Log.e("<<<-http_log_tag->>>", "Error in Http Connection" + e.toString());
		}
	}
	
}
