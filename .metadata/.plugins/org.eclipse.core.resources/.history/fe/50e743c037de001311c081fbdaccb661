package vdindustries.networking;

import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;

import vdindustries.content.DeficiencyParser;
import android.graphics.Bitmap;
import android.os.AsyncTask;


public class DownloadImages extends AsyncTask<Map<String, String>, Integer, Boolean> {
	
	
	
	private Map<String, Bitmap>	floorImages;
	private Map<String, Bitmap>	roomImages;
	
	
	public DownloadImages(Map<String, Bitmap> floorImgs, Map<String, Bitmap> roomImgs) {
	
		floorImages = floorImgs;
		roomImages = roomImgs;
	}
	
	
	@Override protected Boolean doInBackground(Map<String, String>... params) {
	
		Map<String, String> floorUris = params[0];
		Map<String, String> roomUris = params[1];
		
		Iterator<Entry<String, String>> it_flr = floorUris.entrySet().iterator();
		while (it_flr.hasNext()) {
			Map.Entry<String, String> pairs = (Map.Entry<String, String>) it_flr.next();
//		        System.out.println(pairs.getKey() + " = " + pairs.getValue());
			InputStream is;
			try {
				is = (InputStream) new URL(pairs.getValue()).getContent();
			} catch (IOException e) {
					e.printStackTrace();
//					InputStream is = assMan.open("images/nopic.jpg");
				is = null;
			}
			floorImages.put(pairs.getKey(), DeficiencyParser.loadImageFromUri(is));
			it_flr.remove(); // avoids a ConcurrentModificationException
		}
		
		Iterator<Entry<String, String>> it_rm = roomUris.entrySet().iterator();
		while (it_rm.hasNext()) {
			Map.Entry<String, String> pairs = (Map.Entry<String, String>) it_rm.next();
//		        System.out.println(pairs.getKey() + " = " + pairs.getValue());
			InputStream is;
			try {
				is = (InputStream) new URL(pairs.getValue()).getContent();
			} catch (IOException e) {
					e.printStackTrace();
				is = null;
			}
			
			roomImages.put(pairs.getKey(), is);
			it_rm.remove(); // avoids a ConcurrentModificationException
		}
		
		return true;
	}
	
	
	@Override protected void onProgressUpdate(Integer... progress) {
	
//      setProgressPercent(progress[0]);
	}
	
	
	@Override protected void onPostExecute(Boolean bool) {
	
	}
	
}
